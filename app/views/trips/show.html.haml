.row-fluid.results-header
  .span3
    %h1
      %i{class: "icon #{CsHelpers::ACTION_ICONS[:plan_a_trip]}"}
      = t(:trip_options)

  .span9.well.trip_header
    %div{class: (@trip.in_the_future ? 'span11' : 'span12')}
      = render partial: 'trip_header', locals: {trip: @trip}
    - if @trip.in_the_future
      .span1
        = link_to edit_user_trip_path(@traveler, @trip), :class => "btn btn-small pull-right", :alt => t(:edit_trip), :title => t(:edit_trip) do
          %i.icon-edit


- if @trip.any_parts_selected?
  .row-fluid.selected_notices.results-header
    - if @trip.both_parts_selected?
      .span6
        .alert.alert-success.fade.in
          = content_tag :div, t(:outbound_selected_short)
      .span6
        - if @trip.is_return_trip
          .alert.alert-success.fade.in
            = content_tag :div, t(:return_selected)
    - elsif @trip.only_outbound_selected?
      .span12
        .alert.alert-success.fade.in
          = content_tag :div, t(:outbound_selected)
    - elsif @trip.only_return_selected?
      .span12
        - if @trip.is_return_trip
          .alert.alert-success.fade.in
            = content_tag :div, t(:return_selected)

  - if @trip.both_parts_selected?
    .span12
      %h2 Trip planned and saved.
      / %p You can now do one or more of the following to finish your trip planning:
      / .row-fluid
      /   .span6{style: 'margin-bottom: 9px;'}
      /     =link_to '#', {href: '#send_trip_by_email', class: 'btn btn-block', data: {toggle: 'modal'}} do
      /       %i.icon-envelope
      /       =t(:e_mail) + " your trip plan."
      /   .span6{style: 'margin-bottom: 9px;'}
      /     -if (@trip.outbound_part.selected_itinerary and @trip.outbound_part.selected_itinerary.service) or (@trip.return_part.selected_itinerary and @trip.return_part.selected_itinerary.service)
      /       =link_to '#', {href: '#send_trip_by_email_to_provider', class: 'btn btn-block', data: {toggle: 'modal'}} do
      /         %i.icon-ticket
      /         Email a booking request to the provider.
      /     -else
      /       =link_to '#', {disabled: true, class: 'btn btn-block'} do
      /         %i.icon-ticket
      /         Email a booking request to the provider.
      / .row-fluid
      /   .span6{style: 'margin-bottom: 9px;'}
      /     =link_to '#', {href: '#send_trip_by_email', class: 'btn btn-block', data: {toggle: 'modal'}} do
      /       %i.icon-search
      /       View trip details so that you can call the provider.
      /   .span6{style: 'margin-bottom: 9px;'}
      /     =link_to '#', {href: '#send_trip_by_email', class: 'btn btn-block', data: {toggle: 'modal'}} do
      /       %i.icon-print
      /       Print your trip plan.
      / -if user_signed_in?
      /   .row-fluid
      /     .span6.offset3
      /       =link_to user_trips_path(get_traveler), {class: 'btn btn-block'} do
      /         %i.icon-share-alt.icon-flip-horizontal
      /         I'm done, just show me all my planned trips.



.row-fluid.results-view
  %div.span6
    %div{id: 'outbound_section'}
      .row-fluid.section_header
        .span6
          %a
            %h2
              = t(:outbound)
      .row-fluid.itineraries_holder
        = render :partial => 'trip_itineraries', :locals => {:itineraries => outbound_itineraries(@show_hidden),
          trip_part: @trip.outbound_part }
      - if @trip.outbound_part.has_hidden_options?
        .row-fluid
          .span6#outbound_hidden_trips_notice
            = render partial: 'hidden_trips_notice', locals: {trip_part: @trip.outbound_part}

  - if @trip.is_return_trip
    .span6
      = render partial: 'return_trip'
  
.row-fluid
  .well.well-small.span12
    = link_to new_user_trip_path do
      %i{class: CsHelpers::ACTION_ICONS[:plan_a_trip]}
      = t(:plan_a_new_trip)
    = link_to '#', {href: '#send_trip_by_email', class: "pull-right", data: {toggle: 'modal'}} do
      %i.icon-envelope
      =t(:send_by_email)

    = render partial: 'send_trip_by_email', locals: {trip: @trip}
    = render partial: 'send_trip_by_email_to_provider'


#itinerary_modal.modal.hide.fade

:javascript
  $('#main').css('overflow', 'scroll');
  

  $('#email_itinerary2').on('ajax:success', function (event, data, status, xhr) {
    $('#send_trip_by_email_to_provider #email_email_addresses').val(data['email'])
    $('#send_trip_by_email_to_provider').modal('show')
  })

  /**
   * Adds 0 left margin to the first thumbnail on each row that don't get it via CSS rules.
   * Recall the function when the floating of the elements changed.
   */
  function fixThumbnailMargins() {
      $('.itineraries_holder .thumbnails').each(function () {
          var $thumbnails = $(this).children(),
              previousOffsetLeft = $thumbnails.first().offset().left;
          $thumbnails.removeClass('first-in-row');
          $thumbnails.first().addClass('first-in-row');
          $thumbnails.each(function () {
              var $thumbnail = $(this),
                  offsetLeft = $thumbnail.offset().left;
              if (offsetLeft < previousOffsetLeft) {
                  $thumbnail.addClass('first-in-row');
              }
              previousOffsetLeft = offsetLeft;
          });
      });
  }

  // Fix the margins when potentally the floating changed
  $(window).resize(fixThumbnailMargins);
  fixThumbnailMargins();
